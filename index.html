<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Zecure App</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --primary: #00ff66;
  --bg: #0d1a1f;
  --card: #13252c;
  --input: #1d333b;
  --txt: #ffffff;
}

* {margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI';}

body {
  background: var(--bg);
  color: var(--txt);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* -------- TELAS -------- */
.screen {
  width: 100%;
  max-width: 480px;
  height: 100vh;
  padding: 18px;
  display: none;
  flex-direction: column;
}

.show {
  display: flex !important;
}

/* -------- HEADER -------- */
header {
  font-size: 1.7rem;
  font-weight: bold;
  text-align: center;
  padding: 15px 0;
  color: var(--primary);
}

/* -------- INPUTS -------- */
label {
  margin-top: 12px;
  font-weight: bold;
  color: var(--primary);
}

input, select, textarea {
  width: 100%;
  padding: 14px;
  margin-top: 6px;
  border-radius: 10px;
  border: none;
  background: var(--input);
  color: var(--txt);
  font-size: 1rem;
}
textarea { min-height: 90px; }

/* -------- BOTÕES -------- */
button {
  margin-top: 20px;
  width: 100%;
  padding: 14px;
  background: var(--primary);
  font-weight: bold;
  border-radius: 10px;
  border: none;
  color: #000;
  font-size: 1.1rem;
}
button:hover {opacity: .85; cursor: pointer;}

/* -------- TABS (MENU INFERIOR) -------- */
.tabs {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  max-width: 480px;
  display: flex;
  background: #0b171b;
  border-top: 2px solid #0f2a2f;
}

.tab {
  flex: 1;
  text-align: center;
  padding: 12px 0;
  color: #6d878f;
  font-weight: bold;
}
.tab.active { color: var(--primary); }

/* -------- FOTOS -------- */
.photo-box {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}
.photo-box img {
  width: 78px;
  height: 78px;
  border-radius: 6px;
  object-fit: cover;
}

/* -------- GPS -------- */
.gps-box {
  display: flex;
  margin-top: 10px;
  gap: 10px;
}
.gps-show {
  flex: 1;
  padding: 12px;
  background: var(--input);
  border-radius: 8px;
}
.gps-btn {
  background: #0099ff;
  color: #fff;
  width: auto;
  padding: 12px 18px;
}
</style>
</head>
<body>

<!-- ========================================================= -->
<!-- LOGIN -->
<!-- ========================================================= -->
<div id="login" class="screen show">
  <header>Zecure Login</header>

  <input id="user" placeholder="Usuário">
  <input id="pass" type="password" placeholder="Senha">

  <button onclick="login()">Entrar</button>
</div>

<!-- ========================================================= -->
<!-- INSPEÇÃO -->
<!-- ========================================================= -->
<div id="inspecao" class="screen">

  <header>Nova Inspeção</header>

  <label>Técnico</label>
  <input id="tec" readonly>

  <label>Data/Hora</label>
  <input id="data" readonly>

  <label>Equipamento</label>
  <input id="equip" placeholder="Ex: Bomba, Gerador...">

  <label>Tipo</label>
  <select id="tipo">
    <option>Preventiva</option>
    <option>Corretiva</option>
  </select>

  <label>Fotos Antes</label>
  <input type="file" id="antes" multiple accept="image/*" onchange="preview('antes','prevAntes')">
  <div id="prevAntes" class="photo-box"></div>

  <label>Descrição</label>
  <textarea id="desc"></textarea>

  <label>Fotos Depois</label>
  <input type="file" id="depois" multiple accept="image/*" onchange="preview('depois','prevDepois')">
  <div id="prevDepois" class="photo-box"></div>

  <label>Observações</label>
  <textarea id="obs"></textarea>

  <div class="gps-box">
    <div id="gps" class="gps-show">Localizando...</div>
    <button class="gps-btn" onclick="openMap()">Mapa</button>
  </div>

  <button onclick="gerarPDF()">Gerar PDF</button>
</div>

<!-- ========================================================= -->
<!-- PERFIL -->
<!-- ========================================================= -->
<div id="perfil" class="screen">
  <header>Perfil</header>

  <label>Nome do Técnico</label>
  <input id="perfilNome" readonly>

  <label>Último Login</label>
  <input id="perfilData" readonly>

  <button onclick="logout()">Sair</button>
</div>

<!-- ========================================================= -->
<!-- TABS -->
<!-- ========================================================= -->
<div class="tabs">
  <div class="tab active" onclick="go('inspecao',this)">Inspeção</div>
  <div class="tab" onclick="go('perfil',this)">Perfil</div>
</div>

<script>
window.jsPDF = window.jspdf.jsPDF;

/* LOGIN SIMPLES */
const USERS = {Marcos:"Vila2025",Haniel:"Vila2025",Daniel:"Vila2025",Josue:"Vila2025"};

function login(){
  if(USERS[user.value] !== pass.value) return alert("Credenciais inválidas");

  document.getElementById("login").classList.remove("show");
  document.getElementById("inspecao").classList.add("show");
  tec.value = user.value;

  data.value = new Date().toLocaleString("pt-BR");
  perfilNome.value = user.value;
  perfilData.value = data.value;

  getGPS();
}

/* TABS */
function go(screen, el){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("show"));
  document.getElementById(screen).classList.add("show");

  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
}

/* LOGOUT */
function logout(){
  location.reload();
}

/* GPS */
let gpsCoords = null;

function getGPS(){
  navigator.geolocation.getCurrentPosition(pos=>{
    gpsCoords = pos.coords;
    gps.innerText = pos.coords.latitude.toFixed(6)+", "+pos.coords.longitude.toFixed(6);
  });
}

function openMap(){
  if(!gpsCoords) return alert("GPS não carregado");
  window.open(`https://maps.google.com?q=${gpsCoords.latitude},${gpsCoords.longitude}`);
}

/* PREVIEW FOTO */
function preview(inputId, previewId){
  const box = document.getElementById(previewId);
  box.innerHTML = "";
  [...document.getElementById(inputId).files].forEach(file=>{
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    box.appendChild(img);
  });
}

/* PDF */
async function gerarPDF(){

  const doc = new jsPDF();
  let y = 15;

  doc.setFont("helvetica","bold");
  doc.setFontSize(18);
  doc.text("Relatório de Inspeção",105,y,{align:"center"});
  y+=15;

  doc.setFontSize(12);
  doc.text("Técnico: "+tec.value, 15,y);y+=7;
  doc.text("Data: "+data.value, 15,y);y+=7;
  doc.text("Equipamento: "+equip.value, 15,y);y+=7;
  doc.text("Tipo: "+tipo.value, 15,y);y+=7;
  doc.text("Localização: "+gps.innerText,15,y);y+=12;

  doc.text("Descrição:", 15,y);y+=7;
  let lines = doc.splitTextToSize(desc.value,180);
  doc.text(lines,15,y);
  y+=lines.length*5+10;

  async function addPhotos(label,id){
    const files = document.getElementById(id).files;
    if(!files.length) return;

    doc.addPage();
    y=20;

    doc.setFont("helvetica","bold");
    doc.text(label,15,y);y+=10;

    for(let f of files){
      const b64 = await toBase64(f);
      doc.addImage(b64,"JPEG",15,y,80,60);
      y+=65;
      if(y>260){doc.addPage();y=20;}
    }
  }

  await addPhotos("Fotos - Antes","antes");
  await addPhotos("Fotos - Depois","depois");

  if(obs.value.trim()){
    doc.addPage();
    y=20;
    doc.text("Observações:",15,y);y+=10;
    let obsLines = doc.splitTextToSize(obs.value,180);
    doc.text(obsLines,15,y);
  }

  doc.save("Inspecao_"+tec.value+".pdf");
}

function toBase64(file){
  return new Promise(res=>{
    let r = new FileReader();
    r.onload = e => res(e.target.result);
    r.readAsDataURL(file);
  });
}
</script>

</body>
</html>
